geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("linear")
animate(teams, duration = 90)
View(df)
density_df
View(density_df)
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
fill(col, .direction = "down")
View(joined_df %>%
filter(year == 2019))
View(joined_df %>%
filter(team == "CAR",
year == 2019))
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
fill(col, .direction = "down")
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
mutate(col2 = ifelse(!is.na(lag(col)), lag(col), NA))
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
mutate(col2 = ifelse(!is.na(lag(col)), lag(col), NA))
View(joined_df %>%
filter(team == "CAR",
year == 2019))
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
fill(col, .direction = "down") %>%
mutate(col2 = ifelse(!is.na(lag(col)), lag(col), NA))
View(joined_df %>%
filter(team == "CAR",
year == 2019))
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
fill(col, .direction = "down") %>%
mutate(col2 = ifelse(!is.na(lag(col)), lag(col2), NA))
joined_df <- left_join(density_df, sd_df) %>%
mutate(col = ifelse(p_82 >= safe, "Clinched",
ifelse(p_82 <= out, "Eliminated", NA))) %>%
group_by(team, year) %>%
fill(col, .direction = "down") %>%
mutate(col2 = ifelse(!is.na(lag(col)), lag(col2), NA))
View(joined_df %>%
filter(team == "CAR",
year == 2019))
joined_df %>%
filter(year == 2019) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, col = col, group = team)) +
geom_line(aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(aes(x = GP, y = out), color = "red", size = 2) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 15, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
my_labs +
theme_ice
View(joined_df %>% filter(year == 2015,
!is.na(col)) %>%
group_by(team) %>%
filter(GP == min(GP)) %>%
select(team, col) %>%
ungroup())
View(joined_df %>% filter(year == 2019,
!is.na(col)) %>%
group_by(team) %>%
filter(GP == min(GP)) %>%
select(team, col) %>%
ungroup())
blogdown:::serve_site()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(beepr)
library(gganimate)
library(extrafont)
library(knitr)
theme_ice <- theme_bw() +
theme(
text = element_text(family = "Consolas"),
plot.title = element_text(hjust = .5),
plot.subtitle = element_text(hjust = .5),
panel.grid.minor = element_blank(),
legend.position = "bottom")
my_labs  = list(labs(caption = "IceAnalysis.com | @IceAnalysis"))
load("df_all.Rda")
df <- subset(df_all, GP != "GP") %>%
select(team, year, GP, Date, W, L, OL,) %>%
mutate(GP = as.integer(GP),
Date = as.Date(Date),
W = as.integer(W),
L = as.integer(L),
OL = as.integer(OL),
div = ifelse(team %in% c("TBL",
"BOS",
"TOR",
"MTL",
"FLA",
"BUF",
"DET",
"OTT"), "Atlantic",
ifelse(team %in% c("WSH",
"NYI",
"PIT",
"CAR",
"CBJ",
"PHI",
"NYR",
"NJD"), "Metro",
ifelse(team %in% c("NSH",
"WPG",
"STL",
"DAL",
"COL",
"CHI",
"MIN"), "Central", "Pacific")))) %>%
group_by(team, year) %>%
mutate(pts = W*2 + OL*1,
p_82 = (pts / GP) * 82) %>%
ungroup()
density_df <- df %>%
group_by(team, year) %>%
mutate(final = ifelse(GP == 82, pts, NA)) %>%
fill(final, .direction = "up") %>%
mutate(diff = p_82 - final)
sd_df <- density_df %>%
group_by(GP) %>%
summarize(mean = mean(diff),
upper = round(quantile(diff, .95),0),
lower = round(quantile(diff, .05),0)) %>%
mutate(safe = 95 + upper,
out = 95 + lower) %>%
filter(GP >= 10,
GP < 82)
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas") +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "green", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "red", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("linear")
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 2) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "green", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "red", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs# +
teams
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 4) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "green", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "red", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs# +
teams
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "green", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "red", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs# +
teams
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs# +
teams
library(here)
for (i in teams1819) {
density_df %>%
filter(team == i,
year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82), color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas") +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs +
labs(title = paste0("2018-19 Results ", i)) +
ggsave(path = here::here("static/img/"), filename = paste0("2018-19-", i, ".png"))
}
teams1819 <- c("ANA",
"ARI",
"BOS",
"BUF",
"CAR",
"CBJ",
"CGY",
"CHI",
"COL",
"DAL",
"DET",
"EDM",
"FLA",
"LAK",
"MIN",
"MTL",
"NSH",
"NJD",
"NYI",
"NYR",
"OTT",
"PHI",
"PIT",
"SJS",
"STL",
"TBL",
"TOR",
"VAN",
"VEG",
"WPG",
"WSH")
for (i in teams1819) {
density_df %>%
filter(team == i,
year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82), color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas") +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "darkgreen", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "darkred", size = 2) +
theme_ice +
my_labs +
labs(title = paste0("2018-19 Results ", i)) +
ggsave(path = here::here("static/img/"), filename = paste0("2018-19-", i, ".png"))
}
for (i in teams1819) {
density_df %>%
filter(team == i,
year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82), color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas") +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
labs(title = paste0("2018-19 Results ", i)) +
ggsave(path = here::here("static/img/"), filename = paste0("2018-19-", i, ".png"))
}
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("linear")
animate(teams, fps = 1, duration = 31)
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("sine-in-out")
animate(teams, fps = 1, duration = 31)
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("sine")
animate(teams, fps = 1, duration = 31)
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("sine-in")
animate(teams, fps = 1, duration = 31)
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("sine-out")
animate(teams, fps = 1, duration = 31)
teams <- density_df %>%
group_by(team) %>%
filter(year == 2019) %>%
mutate(lab = ifelse(GP == 82, team, NA)) %>%
filter(GP >=12) %>%
ggplot() +
geom_line(aes(x = GP, y = p_82, group = team),color = "darkblue",  show.legend = F) +
geom_text(aes(x = 82, y = p_82, label = lab, group = team), family = "Consolas", size = 5) +
geom_hline(aes(yintercept = 95), linetype = "dashed") +
labs(title = "When Teams Can Teams be Deemed Clinched or Eliminated",
subtitle = "2018-19 Results",
x = "Games Played",
y = "P/82 Pace") +
annotate("text", x = 20, y = 130, label = "Clinched Line", color = "darkgreen", family = "Consolas") +
annotate("text", x = 25, y = 62, label = "Eliminated Line", color = "darkred", family = "Consolas") +
annotate("text", x= 20, y = 97, label = "95 point cut-off", color = "gray40", family = "Consolas")+
geom_line(data = sd_df, aes(x = GP, y = safe), color = "green", size = 2) +
geom_line(data = sd_df, aes(x = GP, y = out), color = "red", size = 2) +
theme_ice +
my_labs +
transition_states(team,
state_length = 3) +
ease_aes("cubic-in-out")
animate(teams, fps = 1, duration = 31)
animate(teams, fps = 1, duration = 31) + ggsave("teams.gif")
animate(teams, fps = 1, duration = 31) + anim_save("teams.gif")
animate(teams, fps = 1, duration = 31) %>% anim_save("teams.gif")
?anim_save()
animate(teams, fps = 1, duration = 31) %>% anim_save(animation = last_animation(), filename = "teams.gif")
